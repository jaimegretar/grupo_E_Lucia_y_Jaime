---
title: "Suicidio y climas extremos"
author: Jaime Miguel y Lucía Toimil
date: Sys.Date()
output: html_document:
    toc: true
    toc_float: true
---

# INTRODUCCIÓN
**Islandia** se caracteriza por su clima frio y extremo, además de por la escasa cantidad de luz durante gran parte del año. En cambio, **Arizona** tiene un clima cálido y seco, con abundante luz solar la mayor parte del tiempo.
Estos dos lugares, con climas tan extremos y distintos, permiten evaluar de manera comparativa como diferentes condiciones climáticas pueden influir en la **salud mental** y en la tasa de **suicidios**.

# OBJETIVOS
## Objetivo general
Analizar la posible relación entre las condiciones climáticas y la salud mental, evaluando como el clima podría influir en la tasa de suicidios en Islandia y Arizona.

# Objetivos especificos
- Comparar la tasa de suicidios en Islandia y Arizona en relación con sus caracteristicas climáticas.
- Comparar las tasas de suicidios entre hombres y mujeres en ambos lugares
- Estudiar el impacto de episodios extremos de temperatura con suicidios posteriores a ellos.
- Analizar efectos estacionales en las tasas de suicidios.

# METODOLOGÍA
## 1.1. Carga de paquetes:
A continuación se encuentran los paquetes empleados para cargar y trabajar con los datos del seminario.
```{r setup, message=FALSE, warning=FALSE}

library(tidyverse)
library(readr)
library(lubridate)
library(rjstat)     
library(jsonlite)
library(rjson)
library(tidyjson)
library(plotly)
library(dplyr)
```
## 1.2. Obtención de datos de temperatura y suicidio (Islandia y Arizona)
### 1.2.1 Importacion de datos de temperatura:
#### Arizona:
Obtenemos los datos de temperatura de Arizona, desde un archivo .csv y desde un archivo .json
```{r}
# Importacion datos temperatura Arizona .json
Arizona_temp_json <- fromJSON(file = "INPUT/DATA/Arizona/Temperatura/data.json")
Arizona_temp_json %>%
  spread_all() %>%
  View()

# Importacion .csv datos temperatura Arizona
Arizona_temp_csv <- read_delim(file="INPUT/DATA/Arizona/Temperatura/data.csv", delim = ",")
View(Arizona_temp_csv)
```
#### Islandia:
Importacion de los datos de temperatura de Islandia (Reikiavik) en .json, en el periodo del 2018-2023:
```{r}
# Importacion datos temperatura Islandia .json
Islandia_temp_json <- fromJSON(file = "INPUT/DATA/Islandia/Temperatura/temperatura_reykjavik_2018_2023.json")
Islandia_temp_json %>%
  spread_all() %>%
  View()
```
### 1.2.2. Importacion de datos de suicidios:
#### Arizona:
Importamos los datos de suicidios de Arizona (relacionados con salud mental) desde un archivo CSV. Se especifican los nombres de las columnas y se salta la fila de encabezado defectuosa.
```{r}
Arizona_suicidioRegion_csv <- read_csv(
  file = "INPUT/DATA/Arizona/Salud/HDPulse_data_export.csv",
  col_names = c(
    "Region",
    "FIPS",
    "Death_Rate",
    "CI_Lower",
    "CI_Upper",
    "Num_Deaths",
    "Trend",
    "Annual_Change",
    "CI_Lower_Change",
    "CI_Upper_Change"
  ),
  skip = 1,
  trim_ws = TRUE,
  show_col_types = FALSE
)

View(Arizona_suicidioRegion_csv)
```
Otro archivo .csv para complementar los datos de suicidios de Arizona desde el 2018-2023.
```{r}
# Importacion suicidios Arizona 2 del 2018 al 2023
datos2 <- read.csv("INPUT/DATA/Arizona/Salud/reports-data-export.csv",
                   header = TRUE,
                   stringsAsFactors = FALSE)

# Usar una expresión regular sofisticada para separar respetando las comillas
datos_separados <- datos2 %>%
  mutate(linea = .[[1]]) %>%
  separate(linea,
           into = c("Intent", "Year", "Age_Group", "Sex", "Deaths",
                    "Population", "Crude_Rate", "Age_Adjusted_Rate",
                    "Years_Potential_Life_Lost"),
           sep = ',(?=(?:[^"]*"[^"]*")*[^"]*$)', # Separar por comas fuera de comillas
           extra = "merge") %>%
  mutate(across(everything(), ~str_replace_all(., '"', ''))) %>% # Quitar comillas
  select(-1) # Eliminar la primera columna original

# Ver resultado
head(datos_separados)
str(datos_separados)
```
#### Islandia:
Importamos los datos de suicidios de Islandia desde un archivo JSON con formato JSON-stat.
```{r}
# Importacion .json datos suicidios de Islandia (relacionado con salud mental)
Islandia_suicidio_json <- fromJSONstat("INPUT/DATA/Islandia/Salud/suicidios_islandia.json")
df <- as.data.frame(Islandia_suicidio_json)
View(df)
```

